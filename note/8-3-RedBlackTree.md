## 1.红黑树的定义
---
满足如下性质的二叉搜索树：
- 1. 每个节点或黑或红
- 2. 根节点是黑色的
- 3. 如果一个节点是红色的，那么它的子节点必须是黑色的（父也必须是黑色的）
- 4. 从**任何一个节点**出发到空节点的路径上，必须包含相同数目的黑节点

- 如果忽略红节点而只考虑黑节点，这棵树是完全平衡的
- 每条路径上红节点的个数都是有限的
- 各条路径的长度差是有限的，最长的路径是最短路径的一倍，因为最长的路径由红黑节点相间组成

- 任何一个从根到空节点的路径上有H个黑节点，整棵树必须有至少2^H-1个黑节点，至多有2^2H-1个节点
- 如果N是红黑树中黑节点的个数，那么红黑树的高度至多为2log(N+1)


## 2. 插入操作
---
- 新节点总是作为叶节点插入的
- 只能将新插入的节点着色为红色，因为要满足性质4
- 如果新插入的节点的父节点是黑色的，则平衡没有被破坏
- 如果新插入的节点的父节点是红色的，将出现连续的红节点，违背性质3,需要进行调整（修改旋转和颜色）
### 情况1：新插入节点X的父节点P的兄弟节点S是黑色的
- 节点X插入之前，X的祖父节点肯定是黑色的
1. X是G的外侧节点
- LLb
- RRb
2. X是G的内侧节点
- LRb
- RLb

- 以上两种子情况，经过调整后的子树的根都是黑色的，因此即使原来的曾祖父是红节点也不会出现连续红节点的问题
- 所以情况1只要经过**一次**单旋转(LL,RR)或双旋转(LR,RL)就解决了

### 情况2：新插入节点X的父节点P的兄弟节点S是红色的
- X的祖父节点一定是黑色的
- 通过重新着色来解决连续红节点问题：把祖父节点变成红色，父节点和父节点的兄弟变成黑色。
- 但若X的曾祖父节点为红色，则需要继续往上调整，最坏情况下可能要调整到根
- 根节点一定是黑色的，因此调整到根节点即可结束


## 3. 删除操作
---
- 首先使用普通二叉搜索树的删除算法删除节点，然后进行旋转和颜色调整
- 二叉搜索树的删除最终可以归结到两种情况：删除叶节点和删除只有一个儿子的节点；只要解决这两种情况下的着色问题，就解决了红黑树的删除
- 三种情况：
### 3.1 删除的是红色叶节点
分析:
- 不会影响任何路径上黑节点的个数，也不会造成连续的红节点  

操作:
- 可以直接删除
### 3.2 删除只有一个儿子的节点
分析:
- 该节点的儿子一定是红色的，否则违反性质4
- 被删的节点一定是黑色的，否则违反性质3
- 因此情况2一定是：被删节点是黑色的，只有一个红色儿子

操作:
- 用唯一儿子代替被删节点，同时将儿子颜色改为黑色
### 3.3 删除一个黑色的叶节点
- 分析:
- 会使该路径少一个黑节点，情况比较复杂，需要旋转和调整颜色来恢复红黑树平衡
- 旋转与着色方法取决于被调整节点兄弟的状态:
1. 被调整节点的兄弟是黑色的（包括空节点）
   - 根据兄弟节点的儿子进一步分为4种子情况   

    ||情况名称|情况描述|操作|
    ---|---|---|---|---
    1| L0(R0)   |兄弟节点有0个红儿子             |着色+向上继续调整|
    2| L1L(R1R) |兄弟有一个红儿子,且为它的外侧儿子 |单旋转+着色|
    3| L1R(R1L) |兄弟有一个红儿子,且为它的内侧儿子 |双旋转+着色|
    4| L2(R2)   |兄弟有两个红儿子               |双旋转+着色|
2. 被调整节点的兄弟是红色的
   - 父节点一定是黑色的，兄弟节点的儿子也一定是黑色的  
   - 操作：
   - 改变兄弟和父节点的颜色，并对父节点做单旋转，转换为情况3-1


## 插入删除总结
---
- 插入删除都是：自顶向下查找+自底向上调整，最坏情况下要回溯到根节点，效率较差
- 还有方法在查找的过程中调整颜色，使得最后在插入或删除时至多需要一次旋转，不会有回溯——**自顶向下的红黑树**